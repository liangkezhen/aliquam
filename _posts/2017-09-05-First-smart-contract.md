---
layout: post
title:  以太坊智能合约范例 
category: tech 
comments: true
description: 
tags:
    - blockchain 
---


以下是从网上找到的一个以太坊智能合约代码例程，通过编译这个合约代码，掌握智能合约的使用方法.

```
contract HelloWorld
{
    address creator;
    string greeting;

    function HelloWorld(string _greeting) public
    {
        creator = msg.sender;
        greeting = _greeting;
    }

    function greet() constant returns (string)
    {
        return greeting;
    }

    function setGreeting(string _newgreeting)
    {
        greeting = _newgreeting;
    }

     /**********
     Standard kill() function to recover funds
     **********/

    function kill()
    {
        if (msg.sender == creator)
            suicide(creator);  // kills this contract and sends remaining funds back to creator
    }
}
```

通过在线编译器进行编译,得到如下编译后的代码，并将它们复制到geth 客户端中（也可以通将它们写入文件，通过loadscript 执行。 

[https://ethereum.github.io/browser-solidity/](https://ethereum.github.io/browser-solidity/)


```

var _greeting = "hello world !" ;
var browser_helloword_sol_helloworldContract = web3.eth.contract([{"constant":false,"inputs":[],"name":"kill","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_newgreeting","type":"string"}],"name":"setGreeting","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"greet","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_greeting","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]);
var browser_helloword_sol_helloworld = browser_helloword_sol_helloworldContract.new(
   _greeting,
   {
     from: web3.eth.accounts[0], 
     data: '0x6060604052341561000f57600080fd5b6040516104c73803806104c783398101604052808051820191905050336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508060019080519060200190610081929190610088565b505061012d565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100c957805160ff19168380011785556100f7565b828001600101855582156100f7579182015b828111156100f65782518255916020019190600101906100db565b5b5090506101049190610108565b5090565b61012a91905b8082111561012657600081600090555060010161010e565b5090565b90565b61038b8061013c6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806341c0e1b514610053578063a413686214610068578063cfae3217146100c557600080fd5b341561005e57600080fd5b610066610153565b005b341561007357600080fd5b6100c3600480803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506101e4565b005b34156100d057600080fd5b6100d86101fe565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101185780820151818401526020810190506100fd565b50505050905090810190601f1680156101455780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156101e2576000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b565b80600190805190602001906101fa9291906102a6565b5050565b610206610326565b60018054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561029c5780601f106102715761010080835404028352916020019161029c565b820191906000526020600020905b81548152906001019060200180831161027f57829003601f168201915b5050505050905090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106102e757805160ff1916838001178555610315565b82800160010185558215610315579182015b828111156103145782518255916020019190600101906102f9565b5b509050610322919061033a565b5090565b602060405190810160405280600081525090565b61035c91905b80821115610358576000816000905550600101610340565b5090565b905600a165627a7a7230582009ef3a716ff2cecdb23e9553a883655a3a95b461ff1408ea333974f3bd8456830029', 
     gas: '430000'
   }, function (e, contract){
    console.log(e, contract);
    if (typeof contract.address !== 'undefined') {
         console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
    }
 })
``` 
 
 
 该合约通过挖矿后，保存起来。为了验证合约有效, 从编译完的语句中，看到合约被定义为变量 browser\_helloword\_sol\_helloworld,  调用以下语句，输出是一个非0 ，证明合约已经生成了.
 
  ```
   > eth.getCode(browser_helloword_sol_helloworld.address)
"0x60606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806341c0e1b514610053578063a413686214610068578063cfae3217146100c557600080fd5b341561005e57600080fd5b610066610153565b005b341561007357600080fd5b6100c3600480803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506101e4565b005b34156100d057600080fd5b6100d86101fe565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101185780820151818401526020810190506100fd565b50505050905090810190601f1680156101455780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156101e2576000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b565b80600190805190602001906101fa9291906102a6565b5050565b610206610326565b60018054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561029c5780601f106102715761010080835404028352916020019161029c565b820191906000526020600020905b81548152906001019060200180831161027f57829003601f168201915b5050505050905090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106102e757805160ff1916838001178555610315565b82800160010185558215610315579182015b828111156103145782518255916020019190600101906102f9565b5b509050610322919061033a565b5090565b602060405190810160405280600081525090565b61035c91905b80821115610358576000816000905550600101610340565b5090565b905600a165627a7a7230582009ef3a716ff2cecdb23e9553a883655a3a95b461ff1408ea333974f3bd8456830029"
  ```
  
 进一步，通过调用合约执行函数，输出字符串
 
 ```
 > browser_helloword_sol_helloworld.greet()
"hello world !"
 ```
 
 
 
 

